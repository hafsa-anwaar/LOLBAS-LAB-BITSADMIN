{"$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#", "contentVersion": "1.0.0.0", "parameters": {"workspace": {"type": "String"}}, "resources": [{"id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/8c2c0a8b-91e7-4b3e-9f3c-ps-net-dl')]", "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/8c2c0a8b-91e7-4b3e-9f3c-ps-net-dl')]", "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules", "apiVersion": "2021-03-01-preview", "kind": "Scheduled", "properties": {"displayName": "PowerShell Network Download (Generic) by Hafsah Ali", "description": "Detects PowerShell downloading content via common methods. Technique: .", "severity": "high", "enabled": true, "query": "SecurityEvent | where (EventID == 4688 and NewProcessName endswith @'\\\\\\\\powershell.exe' and (CommandLine contains 'Invoke-WebRequest' or CommandLine contains 'iwr' or CommandLine contains 'wget ' or CommandLine contains 'curl ' or CommandLine contains 'System.Net.WebClient' or CommandLine contains 'DownloadFile(' or CommandLine contains 'Start-BitsTransfer'))", "queryFrequency": "PT30M", "queryPeriod": "PT30M", "triggerOperator": "GreaterThan", "triggerThreshold": 0, "suppressionDuration": "PT2H30M", "suppressionEnabled": true, "tactics": [], "incidentConfiguration": {"createIncident": true, "groupingConfiguration": {"enabled": false, "reopenClosedIncident": false, "lookbackDuration": "PT2H30M", "matchingMethod": "AllEntities", "groupByEntities": [], "groupByAlertDetails": [], "groupByCustomDetails": []}}, "eventGroupingSettings": {"aggregationKind": "SingleAlert"}, "alertDetailsOverride": null, "customDetails": null, "templateVersion": "1.0.0"}}]}
